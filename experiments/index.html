<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Experiment Management - HANNAH</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Experiment Management";
        var mkdocs_page_input_path = "experiments.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> HANNAH
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../fallacies/">Fallacies and Pitfalls</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../publications/">Publications</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Experiment Management</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Configuration</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration/configuration/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration/configuration/multi_gpu/">Multi-GPU support</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Compression</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../compression/compression/quantization/">Quantization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../compression/compression/pruning/">Pruning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../compression/compression/clustering/">Clustering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../compression/compression/decomposition/">Tensor Decompositions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../compression/compression/knowledge_distillation/">Knowledge Distillation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Optimization</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../optimization/optimization/hyperparameter/">Hyperparameter Optimization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Neural Architecture Search</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../neural-architecture-search/nas/legacy/">NAS (Legacy)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../neural-architecture-search/nas/usage/">Usage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../neural-architecture-search/nas/search_spaces/">Search Spaces</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../neural-architecture-search/nas/parametrization/">Parametrization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../neural-architecture-search/nas/search/">Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../neural-architecture-search/nas/eval/">Evaluating Results</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../neural-architecture-search/nas/metrics/">Optimization Metrics</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../deployment/deployment/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deployment/deployment/torchmobile/">Torch Mobile</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deployment/deployment/trax-Ultratrail/">T-Rax Ultratrail</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deployment/deployment/tvm/">TVM</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deployment/deployment/tensorrt/">TensorRT</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Evaluation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../evaluation/eval/">Evaluation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">applications</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../applications/applications/seizure_detection/">Seizure Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../applications/applications/viterbi_decoding/">Viterbi Decoding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../development/devel/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/devel/debugging/">Debugging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/devel/profiling/">Profiling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/devel/api/">API Documentation</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">HANNAH</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Experiment Management</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <!--
Copyright (c) 2023 Hannah contributors.

This file is part of hannah.
See https://github.com/ekut-es/hannah for further info.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<h1 id="experiment-mangement">Experiment Mangement</h1>
<p>It is common to create a new directory for each group of experiments, usually these are group around
a specific publication goal or project.</p>
<p>Hydra configuration options are taken from one of the following possibilities.</p>
<ol>
<li>A local <code>config.yml</code> taken from the directory in which the command is run.</li>
<li>Configuration group overrides from any subdirectory of the current working directory named after a configuration group</li>
<li>Overrides from a special configuration group usually called <code>experiments</code></li>
</ol>
<p>for an example on experiment management have a look at <code>experiments/cifar10</code>.</p>
<p>It has the following directory structure:</p>
<div class="codehilite"><pre><span></span><code>.
├── augmentation
│   └── cifar_augment.yaml
├── config.yaml
├── datasets
│   └── ...
├── experiment
│   ├── sweep_lr.yaml
│   └── sweep_models.yaml
├── scripts
│   └── train_slurm.sh
└── trained_models
    ├── sweep_lr
    |   ├── 0.0001
    |   ├── ...
    └── sweep_models
        ├── multirun.yaml
        └── resnet18
</code></pre></div>

<p>The main configuration is found in <code>config.yaml</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">defaults</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base_config</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cifar10</span><span class="w">          </span><span class="c1"># Dataset configuration name</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">identity</span><span class="w">        </span><span class="c1"># Feature extractor configuration name (use identity for vision datasets)</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timm_resnet18</span><span class="w">      </span><span class="c1">#timm_mobilenetv3_small_100      # Neural network name (for now timm_resnet50 or timm_efficientnet_lite1)</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override scheduler</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1cycle</span><span class="w">         </span><span class="c1"># learning rate scheduler config name</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override optimizer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sgd</span><span class="w">            </span><span class="c1"># Optimizer config name</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override normalizer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w">          </span><span class="c1"># Feature normalizer (used for quantized neural networks)</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">image_classifier</span><span class="w">  </span><span class="c1"># Lightning module config for the training loop (image classifier for image classification tasks)</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override augmentation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cifar_augment</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_self_</span><span class="w"></span>


<span class="nt">monitor</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">metric</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">val_f1_micro</span><span class="w"></span>
<span class="w">  </span><span class="nt">direction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">maximize</span><span class="w"></span>

<span class="nt">module</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span><span class="w"></span>

<span class="nt">trainer</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">max_epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span><span class="w"></span>

<span class="nt">scheduler</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">max_lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w"></span>
</code></pre></div>

<p>The configuration is composed from the standard presets in <code>base_config</code> the defaults are then using different config group presets, using the
<code>- override &lt;groupname&gt;: &lt;presetname&gt;</code> syntax. Most of the presets are taken from the package wide configuration in <code>hannah/conf</code>. The configuration for data augmentation is defined in: <code>augmentation/cifar_augment.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">batch_augment</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">  </span><span class="nt">transforms</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">RandomVerticalFlip</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span><span class="w"></span>
<span class="w">    </span><span class="nt">RandomCrop</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">32</span><span class="p p-Indicator">,</span><span class="nv">32</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">      </span><span class="nt">padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
</code></pre></div>

<p>This file specifies the presets for data augmentation shared among the experiments in this group of experiments.</p>
<p>The experiments are then defined in for example <code>experiment/sweep_lr.yaml</code> and <code>experiment/sweep_model.yaml</code>.
These experiments can be started with: <code>hannah-train +experiment=&lt;experiment_name&gt;</code>. Please note the <strong>+</strong> in front
of the commandline argument. This is needed as <code>experiment</code> is not part of default configuration hierarchy.</p>
<p>As an example have a look at <code>experiment/sweep_lr.yaml</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># @package _global_</span><span class="w"></span>
<span class="nt">experiment_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sweep_lr</span><span class="w"></span>
<span class="nt">hydra</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MULTIRUN</span><span class="w"></span>
<span class="w">  </span><span class="nt">sweep</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">subdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lr=${scheduler.max_lr}</span><span class="w"></span>
<span class="w">  </span><span class="nt">sweeper</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">params</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">scheduler.max_lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0001,0.001,0.01,0.1</span><span class="w"></span>
</code></pre></div>

<p>Experiments must start with <code># @package _global_</code> this means that overrides defined here change the global
configuration and not some values under <code>experiment</code>. The next line sets the <code>experiment_id</code> this is used
to identify the experiment and set a different subfolder for the output artifacts (normally: <code>trained_models/&lt;experiment_id&gt;</code>).</p>
<p>The final part of the configuration then configures a sweep over multiple parameters. In this case
we configure a sweep over the <code>max_lr</code> parameter of the used 1cycle learning rate scheduler, and configure the output directory
to contain a separate subdirector <code>lr=0.0001</code>, <code>lr=0.001</code> for each setting of the max_lr parameter.</p>
<p>The final outputs can then be found in <code>trained_models/sweep_lr/lr\=0.0001/</code> and so on.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../publications/" class="btn btn-neutral float-left" title="Publications"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../configuration/configuration/overview/" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../publications/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../configuration/configuration/overview/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
